<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             680106a66118e             |
    |_______________________________________|
*/
 namespace Pmpr\Module\WoocommerceGateway; use Exception; use nusoap_client; use Pmpr\Common\Foundation\FormGenerator\Backend\Field\Select; use Pmpr\Common\Foundation\FormGenerator\Backend\Field\Text; use Pmpr\Common\Foundation\FormGenerator\Backend\Traits\SectionsTrait; use Pmpr\Common\Foundation\Functions\Traits\HelperTrait; use Pmpr\Common\Foundation\Functions\Traits\WrapperTrait; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Common\Foundation\Interfaces\IconInterface; use Pmpr\Common\Foundation\Template\Traits\TemplateTrait; use Pmpr\Common\Foundation\Traits\HookTrait; use SoapClient; use WC_Order; use WC_Payment_Gateway; use WP_Error; abstract class Gateway extends WC_Payment_Gateway { use SectionsTrait, TemplateTrait, WrapperTrait, HelperTrait, HookTrait; const gyagiysyoqyykmuw = 'sandbox_mode'; const oyqcukwqaucsgiem = 'transaction_id'; const icksoamomukcsmom = 'direct_redirect'; const ggeacgesimkmaimw = 'reversal_done'; const sqsiikyqkwyyeoca = 'reversal_error'; const sockwoyeosqcegek = 'connection_error'; const iccqmesicoqwgigu = Constants::uasuowkaguiwoouw . Constants::aoieosqmocoaqwko; const ukcossyiwqkkgewo = Constants::amcogigwsaqssuai . Constants::aoieosqmocoaqwko; const eowogukiswiwgsyy = Constants::moimkuyueiyqwyki . Constants::aoieosqmocoaqwko; const iyicssquaqcyegkc = self::ggeacgesimkmaimw . Constants::aoieosqmocoaqwko; const kskamgokumqisqui = self::sqsiikyqkwyyeoca . Constants::aoieosqmocoaqwko; const mqcksmagsgegwsks = self::sockwoyeosqcegek . Constants::aoieosqmocoaqwko; const weuiugaiuoakiwyi = 'woocommerce_payment_gateway_transaction_data'; const yqgygsweuqmcwauw = '_verification_params'; protected ?int $order = 0; protected ?array $messages = [Constants::uasuowkaguiwoouw => '', Constants::amcogigwsaqssuai => '', Constants::moimkuyueiyqwyki => '', Constants::ukaqkkkyywmiuoac => '']; protected $verification = null; protected bool $sandbox = false; protected bool $directRedirect = false; protected bool $canDirectRedirect = true; public function maykokweoauomygc() : bool { return $this->sandbox; } public function __construct() { if (!$this->id) { $this->id = strtolower(str_replace('\\', '-', static::class)); } $this->init_form_fields(); $this->init_settings(); $this->qiccuiwooiquycsg(); $this->title = $this->get_option(Constants::qescuiwgsyuikume); $this->sandbox = $this->get_option(self::gyagiysyoqyykmuw) === Constants::wiquocqckkqkmayo; $this->has_fields = false; $this->description = $this->get_option(Constants::eqkeooqcsscoggia); $this->directRedirect = $this->get_option(self::icksoamomukcsmom, false) === Constants::wiquocqckkqkmayo; $this->method_description = $this->method_description ?: sprintf(__('%s gateway settings for woocommerce', PR__MDL__WOOCOMMERCE_GATEWAY), $this->method_title); $this->messages = [Constants::uasuowkaguiwoouw => $this->get_option(self::iccqmesicoqwgigu), Constants::amcogigwsaqssuai => $this->get_option(self::ukcossyiwqkkgewo), Constants::moimkuyueiyqwyki => $this->get_option(self::eowogukiswiwgsyy), self::ggeacgesimkmaimw => $this->get_option(self::iyicssquaqcyegkc), self::sqsiikyqkwyyeoca => $this->get_option(self::kskamgokumqisqui), self::sockwoyeosqcegek => $this->get_option(self::mqcksmagsgegwsks)]; if (!$this->icon && ($mcqieaigyeeyaksm = $this->get_option(Constants::mkousmkiawwousws))) { $wwgucssaecqekuek = $this->ocksiywmkyaqseou('woocommerce_gateway_icon_attrs', []); if (is_numeric($mcqieaigyeeyaksm)) { $oiegiwogmwmawkeo = $this->ocksiywmkyaqseou('woocommerce_gateway_icon_size', Constants::egwoacukmsioosum); $this->icon = $this->caokeucsksukesyo()->iqsmaqoiukeasukw()->qaeeusqkgwagwaqc($mcqieaigyeeyaksm, $oiegiwogmwmawkeo, $wwgucssaecqekuek); } else { $this->icon = $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->cuoygaaeqeqcuggu($mcqieaigyeeyaksm, $wwgucssaecqekuek, [Constants::ELEMENT => 'img']); } } $egkyssmuqcwaciya = strtolower(wc_clean($this->uwkmaywceaaaigwo()->gksccikkaamikckm()->wkcwykowmmmwioqs(static::class))); $this->qcsmikeggeemccuu("woocommerce_api_{$egkyssmuqcwaciya}", [$this, 'kegocacsgeuwokyc'])->qcsmikeggeemccuu("woocommerce_receipt_{$this->id}", [$this, 'uusaesoqsueyqmec'])->qcsmikeggeemccuu("woocommerce_update_options_payment_gateways_{$this->id}", [$this, 'process_admin_options']); } public function init_form_fields() { $uuyucgkyusckoaeq = $this->caokeucsksukesyo()->wmkogisswkckmeua(); $this->kwkugmqouisgkqig($uuyucgkyusckoaeq->ycgeeoiieoiakgam(Constants::ioomakeyqiqowgmk)->saemoowcasogykak(IconInterface::wukkqukiiuuoyiiy)->gswweykyogmsyawy(__('General Configuration', PR__MDL__WOOCOMMERCE_GATEWAY))->mkksewyosgeumwsa($uuyucgkyusckoaeq->wcwmusaouiqaqeww(Constants::yyicwqsqaecyqwco)->gswweykyogmsyawy(__('Activation', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(__('To activate this payment gateway, you must check the checkbox.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->wcwmusaouiqaqeww(self::gyagiysyoqyykmuw)->gswweykyogmsyawy(__('Enable Sandbox Mode', PR__MDL__WOOCOMMERCE_GATEWAY))->wywmmeyauqkeskeq($this->komsuiqwsgsqcumg())->gucwmccyimoagwcm(__('By enable this option, after successful payment reversal request send to bank gateway.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->ymuegqgyuagyucws(Constants::qescuiwgsyuikume)->gswweykyogmsyawy(__('Gateway Title', PR__MDL__WOOCOMMERCE_GATEWAY))->eyygsasuqmommkua($this->method_title)->gucwmccyimoagwcm(__('The title of the gateway that is displayed to the customer during the purchase.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(Constants::eqkeooqcsscoggia)->gswweykyogmsyawy(__('Gateway Description', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(sprintf(__('Secure payment by all Shetab member cards through %s.', PR__MDL__WOOCOMMERCE_GATEWAY), $this->method_title))->gucwmccyimoagwcm(__('Descriptions that will be displayed to the gateway during the payment process.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->gosycecgwuesyysq(Constants::mkousmkiawwousws)->gswweykyogmsyawy(__('Gateway Image', PR__MDL__WOOCOMMERCE_GATEWAY))->mkmssscwmeekwgqo()->gucwmccyimoagwcm(__('The image of the gateway that is displayed to the customer during the purchase.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->wcwmusaouiqaqeww(self::icksoamomukcsmom)->wywmmeyauqkeskeq($this->qsmkuewgogmiyake())->gswweykyogmsyawy(__('Direct Redirect', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(sprintf('%s<br>%s', __('Enable this option if you want the user to be directed directly to the payment gateway and not click on the preload option on the pre-invoice page.', PR__MDL__WOOCOMMERCE_GATEWAY), __('By default (disabling this option) the buyer first sees the order number and the final price before being directed to the portal, and then is directed to the portal by pressing the confirmation button.', PR__MDL__WOOCOMMERCE_GATEWAY))))); $this->qyeykswoowmwqmai(); $kqmcoiicsmgwaisg = $this->auqyiaissiuomqgs(); $this->kwkugmqouisgkqig($uuyucgkyusckoaeq->ycgeeoiieoiakgam(Constants::eoskkkieowogacws)->saemoowcasogykak(IconInterface::akgsckoogewmyswa)->gswweykyogmsyawy(__('Payment operation Messages', PR__MDL__WOOCOMMERCE_GATEWAY))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::ukcossyiwqkkgewo)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Success Payment Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(__('Thank you, your order is successfully payed.', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(__('The text of message after successful payment.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::iccqmesicoqwgigu)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Failed Payment Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(__('Your payment has failed. Please try again or contact the site administrator if there is a problem.', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(__('Enter the text of the message that you want to display to the user after an unsuccessful payment, this error reason is sent from Bank website.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::eowogukiswiwgsyy)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Cancel Payment Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(__('The payment remained incomplete due to your cancellation.', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(__('Enter the text of the message you want to display after the user cancels the payment, this message will be displayed after returning from the bank.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::mqcksmagsgegwsks)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Connection Error Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(__('Error connecting to the bank, please try again.', PR__MDL__WOOCOMMERCE_GATEWAY))->gucwmccyimoagwcm(__('The text of the message you want to be displayed to the customer after an error in connecting to the bank.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::iyicssquaqcyegkc)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Reversal Done Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(sprintf('%s<br/>%s', __('Your payment has been successfully processed at the bank, but there has been a problem with the service.', PR__MDL__WOOCOMMERCE_GATEWAY), __('The order to return the money to your account has been registered in the bank, if the payment is not returned to your account within the next few hours, contact support. (The final time to return to the account is 72 hours)', PR__MDL__WOOCOMMERCE_GATEWAY)))->gucwmccyimoagwcm(__('The text of the message you want to be displayed to the customer after reversal payment done.', PR__MDL__WOOCOMMERCE_GATEWAY)))->mkksewyosgeumwsa($uuyucgkyusckoaeq->sciaycsmsiekqueg(self::kskamgokumqisqui)->euokiigekgwygigi($kqmcoiicsmgwaisg)->gswweykyogmsyawy(__('Reversal Error Message', PR__MDL__WOOCOMMERCE_GATEWAY))->gsomueooycksswcy()->eyygsasuqmommkua(sprintf('%s<br/>%s', __('Your payment has been successfully processed at the bank, but there has been a problem with the service.', PR__MDL__WOOCOMMERCE_GATEWAY), __('In order to register the order to return the money to your bank account, but unfortunately it encountered an error, please contact support to receive the service or refund the payment.', PR__MDL__WOOCOMMERCE_GATEWAY)))->gucwmccyimoagwcm(__('The text of the message you want to be displayed to the customer when error accrued on reversal payment.', PR__MDL__WOOCOMMERCE_GATEWAY)))); foreach ($this->suuogccckocgseyg() as $awcmekyiwwkeyisq) { foreach ($awcmekyiwwkeyisq->uyaeumskacgcyskk() as $aiowsaccomcoikus) { if ($aiowsaccomcoikus instanceof Text || $aiowsaccomcoikus instanceof Select) { $aiowsaccomcoikus->mkmssscwmeekwgqo(); } $aiowsaccomcoikus->usuqmwksoeaayaig($this->get_field_key($aiowsaccomcoikus->mwikyscisascoeea())); $this->form_fields[$aiowsaccomcoikus->mwikyscisascoeea()] = $aiowsaccomcoikus->sacmkccceuywoqsq(); } } } public function uusaesoqsueyqmec($umwqusowiqmyseom) { if ($this->maykokweoauomygc() && !$this->uwkmaywceaaaigwo()->issssuygyewuaswa()->scmcyesmmikkucie(Constants::wiukckegkqeumqug)) { $this->caokeucsksukesyo()->mmmcswscsiecscwg()->mscqqcmmkkiqwcua(__('Sorry can not process your request right now, please try 1 hour later.', PR__MDL__WOOCOMMERCE_GATEWAY), $umwqusowiqmyseom, true); return; } $this->order = $umwqusowiqmyseom; $this->giyscymwkesykqsg(Constants::geykusaewkemcasi, $umwqusowiqmyseom); $umwqusowiqmyseom = $this->mmmcswscsiecscwg($umwqusowiqmyseom); $eaoumsseceiowgsk = !$this->cqwwgecaqgquyuac(); $aeaqgysgaeowagug = 'wc-gateway-submit'; if ($eaoumsseceiowgsk) { echo $this->iuygowkemiiwqmiw('submit_checkout', ['id' => $this->id, 'submit' => $aeaqgysgaeowagug, 'back_url' => $this->iaekqgkwkckeuwcy(), 'back_text' => __('Back', PR__MDL__WOOCOMMERCE_GATEWAY), 'submit_text' => __('Purchase', PR__MDL__WOOCOMMERCE_GATEWAY)]); } if (!$eaoumsseceiowgsk || isset($_POST[$aeaqgysgaeowagug])) { $gkkgcoiwayaccqgm = $this->kcwiwskyggmcimie($umwqusowiqmyseom); $this->cqscqicucmeamkyq("woocommerce_payment_{$this->id}_gateway", $gkkgcoiwayaccqgm); $sogksuscggsicmac = $this->aqmwamyiwgeeymqa($umwqusowiqmyseom); if (is_wp_error($sogksuscggsicmac)) { $iswcokucwmiosiaq = $this->caokeucsksukesyo()->euekiyuksecoccus()->skauuuoqcaiseuks($sogksuscggsicmac); $this->ayeyyegucgwaukky($iswcokucwmiosiaq, true, $this->iaekqgkwkckeuwcy()); $this->caokeucsksukesyo()->mmmcswscsiecscwg()->mscqqcmmkkiqwcua(sprintf(__('The following error occurred while connecting to the %s payment gateway.', PR__MDL__WOOCOMMERCE_GATEWAY) . "<br>{$iswcokucwmiosiaq}", $this->get_title()), $umwqusowiqmyseom); } } } public function kegocacsgeuwokyc() { $seumokooiykcomco = $this->caokeucsksukesyo()->ayueggmoqeeukqmq(); $aqauykcugwiqkumq = $this->caokeucsksukesyo()->mmmcswscsiecscwg(); $gwqgmkqcgwwmweom = $this->iaekqgkwkckeuwcy(); $gkkgcoiwayaccqgm = $this->get('wc_order', $this->wugwewwmekuaamos(Constants::geykusaewkemcasi)); if (!$gkkgcoiwayaccqgm) { $this->ayeyyegucgwaukky(__('Order ID is not exits', PR__MDL__WOOCOMMERCE_GATEWAY), true, $gwqgmkqcgwwmweom); } $umwqusowiqmyseom = $this->mmmcswscsiecscwg($gkkgcoiwayaccqgm); if (!$this->oqkiygokywqiwmys($umwqusowiqmyseom)) { $icwicymcioeyeyek = $seumokooiykcomco->igawqaomowicuayw(self::weuiugaiuoakiwyi, $umwqusowiqmyseom); $this->ayeyyegucgwaukky(__('The transaction status has already been specified.', PR__MDL__WOOCOMMERCE_GATEWAY), true, $gwqgmkqcgwwmweom, true, $icwicymcioeyeyek); } $this->order = $gkkgcoiwayaccqgm; $sogksuscggsicmac = $this->ussowkigumoaoowo($umwqusowiqmyseom); $this->caokeucsksukesyo()->mskuyeumceaigegs()->debug('gateway verify result', $sogksuscggsicmac); if ($this->maykokweoauomygc()) { $this->ysikoosoqwcuoqqg($gkkgcoiwayaccqgm, $sogksuscggsicmac, __('Sandbox mode is enable and try to reversal payment.', PR__MDL__WOOCOMMERCE_GATEWAY)); } if (!is_array($sogksuscggsicmac)) { $uamcoiueqaamsqma = is_string($sogksuscggsicmac) && strlen($sogksuscggsicmac) > 5 ? $sogksuscggsicmac : __('Transaction validation information is incorrect.', PR__MDL__WOOCOMMERCE_GATEWAY); $this->ayeyyegucgwaukky($uamcoiueqaamsqma, true, $gwqgmkqcgwwmweom, true); } $gkyciwoiiisgywcs = $this->caokeucsksukesyo()->ywqgcuymeiswqyqc(); $icwicymcioeyeyek = $gkyciwoiiisgywcs->get($sogksuscggsicmac, Constants::uiwqcumqkgikqyue, []); $iswcokucwmiosiaq = $gkyciwoiiisgywcs->get($sogksuscggsicmac, Constants::imkacwmiuiykyuim, ''); $iueymcwwscwqkiyq = $gkyciwoiiisgywcs->get($sogksuscggsicmac, Constants::ciywsqoeiymemsys, ''); $uamcoiueqaamsqma = $gkyciwoiiisgywcs->get($sogksuscggsicmac, Constants::eoskkkieowogacws, ''); $goaeqwimyqwgwaam = $gkyciwoiiisgywcs->get($sogksuscggsicmac, self::oyqcukwqaucsgiem, ''); switch ($iueymcwwscwqkiyq) { case Constants::amcogigwsaqssuai: $gwqgmkqcgwwmweom = $this->uwkmaywceaaaigwo()->owicscwgeuqcqaig()->yqymaqmqiqmmmsoo('wc_status', Constants::ckcawaoawwioqecq, $this->get_return_url($umwqusowiqmyseom)); if ($goaeqwimyqwgwaam && $goaeqwimyqwgwaam != 0) { $seumokooiykcomco->ksmqawcowkmegigw('_transaction_id', $goaeqwimyqwgwaam, $gkkgcoiwayaccqgm); } if ($umwqusowiqmyseom->payment_complete($goaeqwimyqwgwaam)) { $this->uauicwgqqogawesc(); $this->yogmqkgmcwscecuy(); $gomwuemmsuooamme = [__('The transaction was successful.', PR__MDL__WOOCOMMERCE_GATEWAY), sprintf("%s: %s", __('Transaction request number', PR__MDL__WOOCOMMERCE_GATEWAY), $goaeqwimyqwgwaam)]; if (is_string($uamcoiueqaamsqma) && $uamcoiueqaamsqma) { $gomwuemmsuooamme[] = $uamcoiueqaamsqma; } $aqauykcugwiqkumq->mscqqcmmkkiqwcua(implode("<br>", $gomwuemmsuooamme), $umwqusowiqmyseom, true); } else { $this->ysikoosoqwcuoqqg($gkkgcoiwayaccqgm, $sogksuscggsicmac, $uamcoiueqaamsqma); } break; case Constants::moimkuyueiyqwyki: $aqauykcugwiqkumq->mscqqcmmkkiqwcua(__('The transaction remained unfinished due to user cancellation.', PR__MDL__WOOCOMMERCE_GATEWAY), $umwqusowiqmyseom, true); break; default: if ($iueymcwwscwqkiyq) { $this->iwgueimoscsicckq($iueymcwwscwqkiyq); } if (!$iswcokucwmiosiaq) { $iswcokucwmiosiaq = __('An error occurred while paying.', PR__MDL__WOOCOMMERCE_GATEWAY); } $aqauykcugwiqkumq->mscqqcmmkkiqwcua(sprintf(__('The following error occurred while returning from %s gateway payment.', PR__MDL__WOOCOMMERCE_GATEWAY), $this->get_title()) . "<br>{$iswcokucwmiosiaq}", $umwqusowiqmyseom, true); break; } $seumokooiykcomco->ksmqawcowkmegigw(self::weuiugaiuoakiwyi, $icwicymcioeyeyek, $umwqusowiqmyseom); $this->iwgueimoscsicckq($iueymcwwscwqkiyq, $uamcoiueqaamsqma, true, $gwqgmkqcgwwmweom, false, $icwicymcioeyeyek); exit; } public function process_payment($order_id) { $umwqusowiqmyseom = $this->mmmcswscsiecscwg($order_id); return [Constants::syomkiqgogwyuiyw => Constants::ckcawaoawwioqecq, Constants::yquayuasseumiiii => $umwqusowiqmyseom->get_checkout_payment_url(true)]; } protected function wugwewwmekuaamos($ymqmyyeuycgmigyo, bool $qauywygqccyqocao = true, bool $kekikiwsckuiyuyo = true) : string { if ($qauywygqccyqocao) { $ymqmyyeuycgmigyo = "{$this->id}_{$ymqmyyeuycgmigyo}"; } return (string) $this->caokeucsksukesyo()->wikusamwomuogoau()->wugwewwmekuaamos($ymqmyyeuycgmigyo, $kekikiwsckuiyuyo, ''); } protected function giyscymwkesykqsg($ymqmyyeuycgmigyo, $eqgoocgaqwqcimie = '', $qauywygqccyqocao = true) : self { if ($qauywygqccyqocao) { $ymqmyyeuycgmigyo = "{$this->id}_{$ymqmyyeuycgmigyo}"; } $this->caokeucsksukesyo()->wikusamwomuogoau()->giyscymwkesykqsg($ymqmyyeuycgmigyo, $eqgoocgaqwqcimie); return $this; } protected function kcwiwskyggmcimie($umwqusowiqmyseom) { if (is_numeric($umwqusowiqmyseom)) { $aokagokqyuysuksm = $umwqusowiqmyseom; } else { if (method_exists($umwqusowiqmyseom, 'get_id')) { $aokagokqyuysuksm = $umwqusowiqmyseom->get_id(); } else { if (!($aokagokqyuysuksm = absint(get_query_var('order-pay')))) { $aokagokqyuysuksm = $umwqusowiqmyseom->id; } } } if (!empty($aokagokqyuysuksm)) { $this->order = $aokagokqyuysuksm; } return $aokagokqyuysuksm; } protected function mmmcswscsiecscwg($umwqusowiqmyseom = 0) { if (empty($umwqusowiqmyseom)) { $umwqusowiqmyseom = $this->order; } if (empty($umwqusowiqmyseom)) { return (object) []; } if (is_numeric($umwqusowiqmyseom)) { $this->order = $umwqusowiqmyseom; $umwqusowiqmyseom = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->get($umwqusowiqmyseom); } return $umwqusowiqmyseom; } public function qewciuyocqwcqgys() { return $this->verification; } protected function uauicwgqqogawesc() { $this->uwkmaywceaaaigwo()->wikusamwomuogoau()->uauicwgqqogawesc(); } protected function yogmqkgmcwscecuy() { $iywiwaoieigskusm = $this->qewciuyocqwcqgys(); if ($iywiwaoieigskusm) { $this->caokeucsksukesyo()->ayueggmoqeeukqmq()->ksmqawcowkmegigw(self::yqgygsweuqmcwauw, $iywiwaoieigskusm, $this->order); } } protected function oqkiygokywqiwmys($umwqusowiqmyseom = 0) : bool { if (empty($umwqusowiqmyseom) && empty($this->order_id)) { return true; } $umwqusowiqmyseom = $this->mmmcswscsiecscwg($umwqusowiqmyseom); if (method_exists($umwqusowiqmyseom, 'needs_payment')) { return $umwqusowiqmyseom->needs_payment(); } if (empty($this->order) && !empty($umwqusowiqmyseom)) { $this->order = $this->kcwiwskyggmcimie($umwqusowiqmyseom); } return !in_array($this->ayeawyuummwiieyi(Constants::ciywsqoeiymemsys), [Constants::amcogigwsaqssuai, Constants::qgmyyeewkieecqck], true); } protected function iwoykscaosqmksku($eyagkkkqkwcuygso) { if (function_exists('func_get_args')) { $ywmkwiwkosakssii = func_get_args(); if (count($ywmkwiwkosakssii) > 1) { $eyagkkkqkwcuygso = array_merge(array_values($ywmkwiwkosakssii), $eyagkkkqkwcuygso); $eyagkkkqkwcuygso = implode('_', array_unique($eyagkkkqkwcuygso)); } } if (is_array($eyagkkkqkwcuygso)) { $eyagkkkqkwcuygso = implode('_', $eyagkkkqkwcuygso); } $eyagkkkqkwcuygso = $this->id . '_' . $eyagkkkqkwcuygso; global $wpdb; $gioggcykgoikcwiy = $wpdb->get_row($this->caokeucsksukesyo()->skckwsgymkimyuwo()->prepare("SELECT * FROM {$wpdb->prefix}postmeta WHERE meta_key='_verification_params' AND meta_value='%s'", $eyagkkkqkwcuygso)); if ($gioggcykgoikcwiy) { return $this->ayeyyegucgwaukky(__('This transaction has been verified once before.', PR__MDL__WOOCOMMERCE_GATEWAY), true, $this->iaekqgkwkckeuwcy(), true); } else { $this->verification = $eyagkkkqkwcuygso; return true; } } protected function ayeawyuummwiieyi($csgiecsagosuucqo, $ggauoeuaesiymgee = '') { if (empty($this->order)) { return ''; } $umwqusowiqmyseom = $this->mmmcswscsiecscwg(); $qgciuiagkkguykgs = 'get_' . $csgiecsagosuucqo; if (method_exists($umwqusowiqmyseom, $qgciuiagkkguykgs)) { $csgiecsagosuucqo = $umwqusowiqmyseom->{$qgciuiagkkguykgs}(); } else { if (!empty($umwqusowiqmyseom->{$csgiecsagosuucqo})) { $csgiecsagosuucqo = $umwqusowiqmyseom->{$csgiecsagosuucqo}; } else { $csgiecsagosuucqo = ''; } } return !empty($csgiecsagosuucqo) ? $csgiecsagosuucqo : $ggauoeuaesiymgee; } public function get_icon() { if ($this->caokeucsksukesyo()->gyecsegqciqykomu()->wmcwegoisyeeosqu($this->icon)) { $wkaqekwwgqsqwcoi = parent::get_icon(); } else { $wkaqekwwgqsqwcoi = $this->sscegwueamckwmcy('woocommerce_gateway_icon', $this->icon, $this->id); } return $wkaqekwwgqsqwcoi; } protected function imkwoeqamegcwwoi() : string { return $this->uwkmaywceaaaigwo()->owicscwgeuqcqaig()->yqymaqmqiqmmmsoo('wc_order', $this->order, WC()->api_request_url(static::class)); } protected function gwqgmkqcgwwmweom(string $eeamcawaiqocomwy = '') { if ($eeamcawaiqocomwy !== '') { if (!headers_sent()) { header('Location: ' . trim($eeamcawaiqocomwy)); } else { $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->sykissckqqccoiqs('script', [], "window.onload = function () { top.location.href = '{$eeamcawaiqocomwy}'; };"); } exit; } } protected function useawgqusasoukqm() { $wwigiesyquoeawog = ''; if ($this->order) { $umwqusowiqmyseom = $this->mmmcswscsiecscwg(); $wwigiesyquoeawog = method_exists($umwqusowiqmyseom, 'get_currency') ? $umwqusowiqmyseom->get_currency() : $umwqusowiqmyseom->get_order_currency(); $miosemuqqeysiuaq = ['irt', 'toman', 'tomaan', 'iran toman', 'iranian toman', 'تومان', 'تومان ایران']; if (in_array(strtolower($wwigiesyquoeawog), $miosemuqqeysiuaq)) { $wwigiesyquoeawog = 'IRT'; } $usqawywoqggugqms = ['irr', 'rial', 'iran rial', 'iranian rial', 'ریال', 'ریال ایران']; if (in_array(strtolower($wwigiesyquoeawog), $usqawywoqggugqms)) { $wwigiesyquoeawog = 'IRR'; } } return $wwigiesyquoeawog; } protected function imuokicsysisyuge($ucwqumgymouywmug = 'IRR') : int { $aumscagymwyyicag = 0; if ($this->order) { $umwqusowiqmyseom = $this->mmmcswscsiecscwg(); if (method_exists($umwqusowiqmyseom, 'get_total')) { $aumscagymwyyicag = $umwqusowiqmyseom->get_total(); } else { $aumscagymwyyicag = (int) $umwqusowiqmyseom->order_total; } $wwigiesyquoeawog = strtoupper($this->useawgqusasoukqm()); $ucwqumgymouywmug = strtoupper($ucwqumgymouywmug); if (in_array($wwigiesyquoeawog, ['IRHR', 'IRHT'])) { $wwigiesyquoeawog = str_ireplace('H', '', $wwigiesyquoeawog); $aumscagymwyyicag *= 1000; } if ($wwigiesyquoeawog === 'IRR' && $ucwqumgymouywmug === 'IRT') { $aumscagymwyyicag /= 10; } if ($wwigiesyquoeawog === 'IRT' && $ucwqumgymouywmug === 'IRR') { $aumscagymwyyicag *= 10; } } return $aumscagymwyyicag; } protected function auqyiaissiuomqgs() : array { return ['fault' => __('Error cause', PR__MDL__WOOCOMMERCE_GATEWAY), 'transaction_id' => __('Transaction ID', PR__MDL__WOOCOMMERCE_GATEWAY)]; } public function cqwwgecaqgquyuac() : bool { return $this->qsmkuewgogmiyake() && $this->directRedirect; } public function qsmkuewgogmiyake() { return $this->canDirectRedirect; } protected function sqmuqsscmimwqoki($ymqmyyeuycgmigyo, $ggauoeuaesiymgee = '') : string { return $this->uwkmaywceaaaigwo()->gksccikkaamikckm()->aoeoykwemwaqsikc($this->caokeucsksukesyo()->giiecckwoyiawoyy()->ayueggmoqeeukqmq($ymqmyyeuycgmigyo, $ggauoeuaesiymgee)); } protected function get($ymqmyyeuycgmigyo, $ggauoeuaesiymgee = '') : ?string { return $this->uwkmaywceaaaigwo()->gksccikkaamikckm()->aoeoykwemwaqsikc($this->caokeucsksukesyo()->giiecckwoyiawoyy()->gkwaaeusmsaywikg($ymqmyyeuycgmigyo, $ggauoeuaesiymgee)); } public function iaekqgkwkckeuwcy() : ?string { return $this->uwkmaywceaaaigwo()->wikusamwomuogoau()->aoqkwiysueqqwigk(); } public function ywgmqwueaugywcwi() : ?array { return $this->messages; } public function sagusgigmkeysock($iueymcwwscwqkiyq) : ?string { return $this->caokeucsksukesyo()->ywqgcuymeiswqyqc()->get($this->ywgmqwueaugywcwi(), $iueymcwwscwqkiyq, ''); } public function ayeyyegucgwaukky($iswcokucwmiosiaq = '', $ycyucwoysmwkgiui = true, $gwqgmkqcgwwmweom = false, $gomwuemmsuooamme = false, $icwicymcioeyeyek = []) { return $this->iwgueimoscsicckq(Constants::uasuowkaguiwoouw, $iswcokucwmiosiaq, $ycyucwoysmwkgiui, $gwqgmkqcgwwmweom, $gomwuemmsuooamme, $icwicymcioeyeyek); } public function xeeymkscwcwqayge($iswcokucwmiosiaq = '', $ycyucwoysmwkgiui = true, $gwqgmkqcgwwmweom = false, $gomwuemmsuooamme = false, $icwicymcioeyeyek = []) { return $this->iwgueimoscsicckq(Constants::amcogigwsaqssuai, $iswcokucwmiosiaq, $ycyucwoysmwkgiui, $gwqgmkqcgwwmweom, $gomwuemmsuooamme, $icwicymcioeyeyek); } public function iacsskacaiaguemw($iswcokucwmiosiaq = '', $ycyucwoysmwkgiui = true, $gwqgmkqcgwwmweom = false, $gomwuemmsuooamme = false, $icwicymcioeyeyek = []) { return $this->iwgueimoscsicckq(Constants::moimkuyueiyqwyki, $iswcokucwmiosiaq, $ycyucwoysmwkgiui, $gwqgmkqcgwwmweom, $gomwuemmsuooamme, $icwicymcioeyeyek); } public function iwgueimoscsicckq($iueymcwwscwqkiyq, $iswcokucwmiosiaq = '', $ycyucwoysmwkgiui = true, $gwqgmkqcgwwmweom = false, $gomwuemmsuooamme = false, $icwicymcioeyeyek = []) { if (!in_array($iueymcwwscwqkiyq, [Constants::moimkuyueiyqwyki, Constants::amcogigwsaqssuai, Constants::uasuowkaguiwoouw], true)) { $iueymcwwscwqkiyq = Constants::uasuowkaguiwoouw; } if (!empty($iswcokucwmiosiaq) && $gomwuemmsuooamme && ($umwqusowiqmyseom = $this->mmmcswscsiecscwg()) && !empty($umwqusowiqmyseom)) { $this->caokeucsksukesyo()->mmmcswscsiecscwg()->mscqqcmmkkiqwcua(sprintf("%s: %s", __('Error', PR__MDL__WOOCOMMERCE_GATEWAY), $iswcokucwmiosiaq), $umwqusowiqmyseom, true); } $uamcoiueqaamsqma = wpautop(wptexturize(trim($this->sagusgigmkeysock($iueymcwwscwqkiyq)))); if (is_array($icwicymcioeyeyek) && $icwicymcioeyeyek) { $this->caokeucsksukesyo()->owgcciayoweymuws()->qquwggyuqouqumam($uamcoiueqaamsqma, $icwicymcioeyeyek); } if ($ycyucwoysmwkgiui) { $this->uwkmaywceaaaigwo()->wikusamwomuogoau()->yiggueaiwiygoiyi($uamcoiueqaamsqma, $iueymcwwscwqkiyq === Constants::amcogigwsaqssuai ? Constants::ckcawaoawwioqecq : Constants::imkacwmiuiykyuim); } if ($gwqgmkqcgwwmweom) { $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy()->gwqgmkqcgwwmweom($gwqgmkqcgwwmweom); exit; } return $uamcoiueqaamsqma; } public function admin_options() { $mgiqqesweuqmsymo = $this->suuogccckocgseyg(); foreach ($mgiqqesweuqmsymo as $awcmekyiwwkeyisq) { foreach ($awcmekyiwwkeyisq->uyaeumskacgcyskk() as $aiowsaccomcoikus) { $aiowsaccomcoikus->iygyugseyaqwywyg($this->get_option($aiowsaccomcoikus->mwikyscisascoeea())); } } $oceoauekaygmuoko = $this->caokeucsksukesyo()->wmkogisswkckmeua()->mkcwgaeaaweamyyg($this->id)->mgisqyswkkuceisu($mgiqqesweuqmsymo)->gswweykyogmsyawy($this->get_method_title())->gucwmccyimoagwcm($this->get_method_description())->saemoowcasogykak(IconInterface::sguaiasamyaamwqi)->render(); echo $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->iaaacsuskiakkwui($oceoauekaygmuoko, ['class' => 'pr-wrap']); } public function ewekkueqocsemugs(string $kgccggmwkeukkkci, $ssqmsiiaiswqgmgm = false) { $qcakkkwickkwyuck = null; if (extension_loaded('soap')) { try { $qcakkkwickkwyuck = new SoapClient($kgccggmwkeukkkci, $ssqmsiiaiswqgmgm); } catch (Exception $wgaoewqkwgomoaai) { $this->uwkmaywceaaaigwo()->wikusamwomuogoau()->yiggueaiwiygoiyi($this->caokeucsksukesyo()->euekiyuksecoccus()->skauuuoqcaiseuks($wgaoewqkwgomoaai), Constants::imkacwmiuiykyuim); } } else { if (class_exists('nusoap_client')) { $qcakkkwickkwyuck = new nusoap_client($kgccggmwkeukkkci, $ssqmsiiaiswqgmgm); } } return $qcakkkwickkwyuck; } public function komsuiqwsgsqcumg() { return $this->caokeucsksukesyo()->ekkwaykokcgqkmoi()->myagqecycsaiyqsk($this, 'reversal'); } public function ysikoosoqwcuoqqg($gkkgcoiwayaccqgm, $icwicymcioeyeyek, $uamcoiueqaamsqma = '') { if ($qgciuiagkkguykgs = $this->komsuiqwsgsqcumg()) { $sogksuscggsicmac = $this->{$qgciuiagkkguykgs}($icwicymcioeyeyek); $aqauykcugwiqkumq = $this->caokeucsksukesyo()->mmmcswscsiecscwg(); if (!is_wp_error($sogksuscggsicmac)) { $aqauykcugwiqkumq->mscqqcmmkkiqwcua(__('The customer paid the amount, but when returning from the bank, there was a problem in providing the service, the order to return the money to the customer\'s account was registered in the bank.', PR__MDL__WOOCOMMERCE_GATEWAY), $gkkgcoiwayaccqgm); $this->iwgueimoscsicckq(self::ggeacgesimkmaimw, $uamcoiueqaamsqma, true, false, false, $icwicymcioeyeyek); } else { $aqauykcugwiqkumq->mscqqcmmkkiqwcua(__('The customer paid the amount, but when he returned from the bank, there was a problem in providing the service, there was an error in the order to return the money to the customer\'s account, this buyer should either be provided with the service or the amount should be returned to his bank account.', PR__MDL__WOOCOMMERCE_GATEWAY), $gkkgcoiwayaccqgm); $this->iwgueimoscsicckq(self::sqsiikyqkwyyeoca, $uamcoiueqaamsqma, true, false, false, $icwicymcioeyeyek); } } } protected abstract function qiccuiwooiquycsg(); protected abstract function aqmwamyiwgeeymqa($umwqusowiqmyseom); protected abstract function ussowkigumoaoowo($umwqusowiqmyseom) : array; protected abstract function qyeykswoowmwqmai(); }
